
#########################################################
# Source Files
#########################################################

add_executable(halide_generator halide_generator.cpp)
target_link_libraries(halide_generator PRIVATE Halide::Generator)

function(make_halide_target tgt triple auto)
    add_halide_library(${tgt}halide_dens_step FROM halide_generator GENERATOR halide_dens_step FUNCTION_NAME halide_dens_step TARGETS ${triple} AUTOSCHEDULER ${auto})
    add_halide_library(${tgt}halide_vel_step FROM halide_generator GENERATOR halide_vel_step FUNCTION_NAME halide_vel_step TARGETS ${triple} AUTOSCHEDULER ${auto})
    add_halide_library(${tgt}halide_bitmap FROM halide_generator  GENERATOR halide_bitmap FUNCTION_NAME halide_bitmap TARGETS ${triple} AUTOSCHEDULER ${auto})

    add_executable(${tgt}main main.cpp)
    target_link_libraries(${tgt}main ${tgt}halide_dens_step ${tgt}halide_vel_step ${tgt}halide_bitmap ${OpenCV_LIBS})
    # needed because vlukan_main, cuda_main etc #includes halide header files generated by bulding main 
    if(NOT tgt STREQUAL "")
        add_dependencies(${tgt}main main)
    endif()
endfunction()

make_halide_target("" host-profile "")
make_halide_target(vulkan_ host-vulkan-profile "")
make_halide_target(cuda_ host-cuda-profile "")
make_halide_target(opencl_ host-opencl-profile "")

